function getText(e,o,t){var n=t.text,l=t.maxreso,i=e.get("description")+" ";return o>l?i="":"hide"==n?i="":"shorten"==n?i=i.trunc(50):"wrap"==n&&(i=stringDivider(i,16,"\n")),i}function createTextStyle(e,o,t){var n=t.align,l=t.baseline,i=t.size,s=parseInt(t.offsetX,10),r=parseInt(t.offsetY,10),a=t.weight,u=parseFloat(t.rotation),f=a+" "+i+" "+t.font,c=t.color,y=t.outline,g=parseInt(t.outlineWidth,10);return new ol.style.Text({textAlign:n,textBaseline:l,font:f,text:getText(e,o,t),fill:new ol.style.Fill({color:c}),stroke:new ol.style.Stroke({color:y,width:g}),offsetX:s,offsetY:r,rotation:u})}function polygonStyleFunction(e,o){return new ol.style.Style({stroke:new ol.style.Stroke({color:"blue",width:1}),fill:new ol.style.Fill({color:"rgba(0, 0, 255, 0.1)"}),text:createTextStyle(e,o,myDom.polygons)})}function lineStyleFunction(e,o){return new ol.style.Style({stroke:new ol.style.Stroke({color:"green",width:2}),text:createTextStyle(e,o,myDom.lines)})}function pointStyleFunction(e,o){return new ol.style.Style({image:new ol.style.Circle({radius:10,fill:new ol.style.Fill({color:"rgba(255, 0, 0, 0.1)"}),stroke:new ol.style.Stroke({color:"red",width:1})}),text:createTextStyle(e,o,myDom.points)})}function init(e,o,t,n){new ol.Map({layers:[new ol.layer.Tile({source:new ol.source.MapQuest({layer:"osm"})}),e,o,t],target:"map",view:new ol.View({center:ol.proj.fromLonLat([n[0].lon,n[0].lat]),zoom:n[0].zoom})})}function stringDivider(e,o,t){if(e.length>o){for(var n=o;n>0&&" "!=e[n]&&"-"!=e[n];)n--;if(n>0){var l;l="-"==e.substring(n,n+1)?e.substring(0,n+1):e.substring(0,n);var i=e.substring(n+1);return l+t+stringDivider(i,o,t)}}return e}var urlPoints="http://127.0.0.1:5984/cherkassy/ed057e7778cefc674caa5241bb000a06",urlLines="http://127.0.0.1:5984/points/53cd2af0e5f105d8085ec5ba69002710",urlPoligons="http://127.0.0.1:5984/points/53cd2af0e5f105d8085ec5ba69002710",myDom,centerPoint=[{lon:32.076877594,lat:49.4384155273,zoom:14}];String.prototype.trunc=String.prototype.trunc||function(e){return this.length>e?this.substr(0,e-1)+"...":this.substr(0)},$(document).ready(function(){var e=new ol.layer.Vector({source:new ol.source.Vector({url:urlPoligons,format:new ol.format.GeoJSON}),style:polygonStyleFunction}),o=new ol.layer.Vector({source:new ol.source.Vector({url:urlLines,format:new ol.format.GeoJSON}),style:lineStyleFunction}),t=new ol.layer.Vector({source:new ol.source.Vector({url:urlPoints,format:new ol.format.GeoJSON}),style:pointStyleFunction});init(e,o,t,centerPoint),$("#refresh-points").refresh(),$("#refresh-lines").refresh(),$("#refresh-polygons").refresh(),$("body").myDom(),console.log("myDom",myDom)}),function(e){e.fn.refresh=function(){this.on("click",function(){e(this).is(e("#refresh-points"))&&vectorPoints.setStyle(pointStyleFunction),e(this).is(e("#refresh-lines"))&&vectorLines.setStyle(lineStyleFunction),e(this).is(e("#refresh-polygons"))&&vectorPolygons.setStyle(polygonStyleFunction)})},e.fn.myDom=function(){return myDom={points:{text:e("#points-text").val(),align:e("#points-align").val(),baseline:e("#points-baseline").val(),rotation:e("#points-rotation").val(),font:e("#points-font").val(),weight:e("#points-weight").val(),size:e("#points-size").val(),offsetX:e("#points-offset-x").val(),offsetY:e("#points-offset-y").val(),color:e("#points-color").val(),outline:e("#points-outline").val(),outlineWidth:e("#points-outline-width").val(),maxreso:e("#points-maxreso").onchange()},lines:{text:e("#lines-text").val(),align:e("#lines-align").val(),baseline:e("#lines-baseline").val(),rotation:e("#lines-rotation").val(),font:e("#lines-font").val(),weight:e("#lines-weight").val(),size:e("#lines-size").val(),offsetX:e("#lines-offset-x").val(),offsetY:e("#lines-offset-y").val(),color:e("#lines-color").val(),outline:e("#lines-outline").val(),outlineWidth:e("#lines-outline-width").val(),maxreso:e("#lines-maxreso").val()},polygons:{text:e("#polygons-text").val(),align:e("#polygons-align").val(),baseline:e("#polygons-baseline").val(),rotation:e("#polygons-rotation").val(),font:e("#polygons-font").val(),weight:e("#polygons-weight").val(),size:e("#polygons-size").val(),offsetX:e("#polygons-offset-x").val(),offsetY:e("#polygons-offset-y").val(),color:e("#polygons-color").val(),outline:e("#polygons-outline").val(),outlineWidth:e("#polygons-outline-width").val(),maxreso:e("#polygons-maxreso").val()}}},e.fn.onchange=function(){return value=this.change(function(){return value=e(this).val(),console.log("$(this).val() inner",value),value}).change().val(),console.log("$(this).val() outer",value),value}}(jQuery);