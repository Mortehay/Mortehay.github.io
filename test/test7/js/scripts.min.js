function polygonStyleFunction(feature,resolution){return new ol.style.Style({stroke:new ol.style.Stroke({color:"blue",width:1}),fill:new ol.style.Fill({color:"rgba(0, 0, 255, 0.1)"}),text:createTextStyle(feature,resolution,myDom.polygons)})}function lineStyleFunction(feature,resolution){return new ol.style.Style({stroke:new ol.style.Stroke({color:"green",width:2}),text:createTextStyle(feature,resolution,myDom.lines)})}function pointStyleFunction(feature,resolution){return new ol.style.Style({image:new ol.style.Circle({radius:10,fill:new ol.style.Fill({color:"rgba(255, 0, 0, 0.1)"}),stroke:new ol.style.Stroke({color:"red",width:1})}),text:createTextStyle(feature,resolution,myDom.points),console:console.log("pointStyleFunction")})}function init(vectorPolygons,vectorLines,vectorPoints,centerPoint){new ol.Map({layers:[new ol.layer.Tile({source:new ol.source.MapQuest({layer:"osm"})}),vectorPolygons,vectorLines,vectorPoints],target:"map",view:new ol.View({center:[-8161939,6095025],zoom:centerPoint[0].zoom,log:console.log(centerPoint[0].lon)})});console.log(centerPoint[0].lon)}function stringDivider(str,width,spaceReplacer){if(str.length>width){for(var p=width;p>0&&" "!=str[p]&&"-"!=str[p];)p--;if(p>0){var left;left="-"==str.substring(p,p+1)?str.substring(0,p+1):str.substring(0,p);var right=str.substring(p+1);return left+spaceReplacer+stringDivider(right,width,spaceReplacer)}}return str}var urlPoints="https://api.myjson.com/bins/4373y",urlLines="https://api.myjson.com/bins/1w3vy",urlPoligons="https://api.myjson.com/bins/3549a",centerPoint=[{lon:-81.61939,lat:60.95025,zoom:4}],myDom={points:{text:$("#points-text"),align:$("#points-align"),baseline:$("#points-baseline"),rotation:$("#points-rotation"),font:$("#points-font"),weight:$("#points-weight"),size:$("#points-size"),offsetX:$("#points-offset-x"),offsetY:$("#points-offset-y"),color:$("#points-color"),outline:$("#points-outline"),outlineWidth:$("#points-outline-width"),maxreso:$("#points-maxreso")},lines:{text:$("#lines-text"),align:$("#lines-align"),baseline:$("#lines-baseline"),rotation:$("#lines-rotation"),font:$("#lines-font"),weight:$("#lines-weight"),size:$("#lines-size"),offsetX:$("#lines-offset-x"),offsetY:$("#lines-offset-y"),color:$("#lines-color"),outline:$("#lines-outline"),outlineWidth:$("#lines-outline-width"),maxreso:$("#lines-maxreso")},polygons:{text:$("#polygons-text"),align:$("#polygons-align"),baseline:$("#polygons-baseline"),rotation:$("#polygons-rotation"),font:$("#polygons-font"),weight:$("#polygons-weight"),size:$("#polygons-size"),offsetX:$("#polygons-offset-x"),offsetY:$("#polygons-offset-y"),color:$("#polygons-color"),outline:$("#polygons-outline"),outlineWidth:$("#polygons-outline-width"),maxreso:$("#polygons-maxreso")}},getText=function(feature,resolution,dom){var type=dom.text.value,maxResolution=dom.maxreso.value,text=feature.get("text")+" ";return console.log("feature.get('text')",feature.get("text")),resolution>maxResolution?text="":"hide"==type?text="":"shorten"==type?text=text.trunc(12):"wrap"==type&&(text=stringDivider(text,16,"\n")),text},createTextStyle=function(feature,resolution,dom){var align=dom.align.value,baseline=dom.baseline.value,size=dom.size.value,offsetX=parseInt(dom.offsetX.value,10),offsetY=parseInt(dom.offsetY.value,10),weight=dom.weight.value,rotation=parseFloat(dom.rotation.value),font=weight+" "+size+" "+dom.font.value,fillColor=dom.color.value,outlineColor=dom.outline.value,outlineWidth=parseInt(dom.outlineWidth.value,10);return new ol.style.Text({textAlign:align,textBaseline:baseline,font:font,text:getText(feature,resolution,dom),fill:new ol.style.Fill({color:fillColor}),stroke:new ol.style.Stroke({color:outlineColor,width:outlineWidth}),offsetX:offsetX,offsetY:offsetY,rotation:rotation})},vectorPolygons=new ol.layer.Vector({source:new ol.source.Vector({url:urlPoligons,format:new ol.format.GeoJSON}),style:polygonStyleFunction}),vectorLines=new ol.layer.Vector({source:new ol.source.Vector({url:urlLines,format:new ol.format.GeoJSON}),style:lineStyleFunction}),vectorPoints=new ol.layer.Vector({source:new ol.source.Vector({url:urlPoints,format:new ol.format.GeoJSON}),style:pointStyleFunction});String.prototype.trunc=String.prototype.trunc||function(n){return this.length>n?this.substr(0,n-1)+"...":this.substr(0)},$(document).ready(function(){init(vectorPolygons,vectorLines,vectorPoints,centerPoint),$("#refresh-points").refresh(),$("#refresh-lines").refresh(),$("#refresh-polygons").refresh()}),function($){$.fn.refresh=function(){this.on("click",function(){$(this).is($("#refresh-points"))&&(console.log("click1"),vectorPoints.setStyle(pointStyleFunction)),$(this).is($("#refresh-lines"))&&(console.log("click2"),vectorLines.setStyle(lineStyleFunction)),$(this).is($("#refresh-polygons"))&&(console.log("click3"),vectorPolygons.setStyle(polygonStyleFunction))})}}(jQuery);