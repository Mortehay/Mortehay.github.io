function getText(feature,resolution,dom){var type=dom.text;console.log("type",type);var maxResolution=dom.maxreso;console.log("maxResolution",maxResolution);var text=feature.get("text")+" ";return resolution>maxResolution?text="":"hide"==type?text="":"shorten"==type?text=text.trunc(12):"wrap"==type&&(text=stringDivider(text,16,"\n")),text}function createTextStyle(feature,resolution,dom){var align=dom.align,baseline=dom.baseline,size=dom.size,offsetX=parseInt(dom.offsetX,10),offsetY=parseInt(dom.offsetY,10),weight=dom.weight,rotation=parseFloat(dom.rotation),font=weight+" "+size+" "+dom.font,fillColor=dom.color,outlineColor=dom.outline,outlineWidth=parseInt(dom.outlineWidth,10);return new ol.style.Text({textAlign:align,textBaseline:baseline,font:font,text:getText(feature,resolution,dom),fill:new ol.style.Fill({color:fillColor}),stroke:new ol.style.Stroke({color:outlineColor,width:outlineWidth}),offsetX:offsetX,offsetY:offsetY,rotation:rotation})}function polygonStyleFunction(feature,resolution){return new ol.style.Style({stroke:new ol.style.Stroke({color:"blue",width:1}),fill:new ol.style.Fill({color:"rgba(0, 0, 255, 0.1)"}),text:createTextStyle(feature,resolution,myDom.polygons)})}function lineStyleFunction(feature,resolution){return new ol.style.Style({stroke:new ol.style.Stroke({color:"green",width:2}),text:createTextStyle(feature,resolution,myDom.lines)})}function pointStyleFunction(feature,resolution){return new ol.style.Style({image:new ol.style.Circle({radius:10,fill:new ol.style.Fill({color:"rgba(255, 0, 0, 0.1)"}),stroke:new ol.style.Stroke({color:"red",width:1})}),text:createTextStyle(feature,resolution,myDom.points),res:console.log("currentRes",resolution)})}function init(vectorPolygons,vectorLines,vectorPoints,centerPoint){new ol.Map({layers:[new ol.layer.Tile({source:new ol.source.MapQuest({layer:"osm"})}),vectorPolygons,vectorLines,vectorPoints],target:"map",view:new ol.View({center:[centerPoint[0].lon,centerPoint[0].lat],zoom:centerPoint[0].zoom})})}function stringDivider(str,width,spaceReplacer){if(str.length>width){for(var p=width;p>0&&" "!=str[p]&&"-"!=str[p];)p--;if(p>0){var left;left="-"==str.substring(p,p+1)?str.substring(0,p+1):str.substring(0,p);var right=str.substring(p+1);return left+spaceReplacer+stringDivider(right,width,spaceReplacer)}}return str}var urlPoints="https://api.myjson.com/bins/4373y",urlLines="https://api.myjson.com/bins/1w3vy",urlPoligons="https://api.myjson.com/bins/3549a",myDom,centerPoint=[{lon:-8161939,lat:6095025,zoom:4}];String.prototype.trunc=String.prototype.trunc||function(n){return this.length>n?this.substr(0,n-1)+"...":this.substr(0)},$(document).ready(function(){var vectorPolygons=new ol.layer.Vector({source:new ol.source.Vector({url:urlPoligons,format:new ol.format.GeoJSON}),style:polygonStyleFunction}),vectorLines=new ol.layer.Vector({source:new ol.source.Vector({url:urlLines,format:new ol.format.GeoJSON}),style:lineStyleFunction}),vectorPoints=new ol.layer.Vector({source:new ol.source.Vector({url:urlPoints,format:new ol.format.GeoJSON}),style:pointStyleFunction});init(vectorPolygons,vectorLines,vectorPoints,centerPoint),$("#refresh-points").refresh(),$("#refresh-lines").refresh(),$("#refresh-polygons").refresh(),$("body").myDom(),console.log("myDom",myDom)}),function($){$.fn.refresh=function(){this.on("click",function(){$(this).is($("#refresh-points"))&&vectorPoints.setStyle(pointStyleFunction),$(this).is($("#refresh-lines"))&&vectorLines.setStyle(lineStyleFunction),$(this).is($("#refresh-polygons"))&&vectorPolygons.setStyle(polygonStyleFunction)})},$.fn.myDom=function(){return myDom={points:{text:$("#points-text").val(),align:$("#points-align").val(),baseline:$("#points-baseline").val(),rotation:$("#points-rotation").val(),font:$("#points-font").val(),weight:$("#points-weight").val(),size:$("#points-size").val(),offsetX:$("#points-offset-x").val(),offsetY:$("#points-offset-y").val(),color:$("#points-color").val(),outline:$("#points-outline").val(),outlineWidth:$("#points-outline-width").val(),maxreso:$("#points-maxreso").val()},lines:{text:$("#lines-text").val(),align:$("#lines-align").val(),baseline:$("#lines-baseline").val(),rotation:$("#lines-rotation").val(),font:$("#lines-font").val(),weight:$("#lines-weight").val(),size:$("#lines-size").val(),offsetX:$("#lines-offset-x").val(),offsetY:$("#lines-offset-y").val(),color:$("#lines-color").val(),outline:$("#lines-outline").val(),outlineWidth:$("#lines-outline-width").val(),maxreso:$("#lines-maxreso").val()},polygons:{text:$("#polygons-text").val(),align:$("#polygons-align").val(),baseline:$("#polygons-baseline").val(),rotation:$("#polygons-rotation").val(),font:$("#polygons-font").val(),weight:$("#polygons-weight").val(),size:$("#polygons-size").val(),offsetX:$("#polygons-offset-x").val(),offsetY:$("#polygons-offset-y").val(),color:$("#polygons-color").val(),outline:$("#polygons-outline").val(),outlineWidth:$("#polygons-outline-width").val(),maxreso:$("#polygons-maxreso").val()}}}}(jQuery);