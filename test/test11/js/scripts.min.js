function buildings(){return xmlhttp=new XMLHttpRequest,xmlhttp.open("GET","http://77.121.192.25/test_cherkassy_buildings.php",!1),xmlhttp.send(),200==xmlhttp.status?cherkassy_buildings=JSON.parse(xmlhttp.responseText):void alert("Ошибка "+xmlhttp.status+": "+xmlhttp.statusText)}function optic_cab_cc__list(){return xmlhttp=new XMLHttpRequest,xmlhttp.open("GET","http://77.121.192.25/optic_cab_cc__list.php",!1),xmlhttp.send(),200==xmlhttp.status?optic_cab_cc__stat=JSON.parse(xmlhttp.responseText):void alert("Ошибка "+xmlhttp.status+": "+xmlhttp.statusText)}function coax_cab_cc__list(){return xmlhttp=new XMLHttpRequest,xmlhttp.open("GET","http://77.121.192.25/coax_cab_cc__list.php",!1),xmlhttp.send(),200==xmlhttp.status?coax_cab_cc__stat=JSON.parse(xmlhttp.responseText):void alert("Ошибка "+xmlhttp.status+": "+xmlhttp.statusText)}function multipair_cab_cc__list(){return xmlhttp=new XMLHttpRequest,xmlhttp.open("GET","http://77.121.192.25/multipair_cab_cc__list.php",!1),xmlhttp.send(),200==xmlhttp.status?multipair_cab_cc__stat=JSON.parse(xmlhttp.responseText):void alert("Ошибка "+xmlhttp.status+": "+xmlhttp.statusText)}function cherkassy_buildings(){return vectorSource=new ol.source.Vector({url:"http://77.121.192.25/test_cherkassy_buildings.php",projection:"EPSG:3857",format:new ol.format.GeoJSON}),_buildings=new ol.layer.Vector({source:vectorSource,name:"buildings"})}function optic_cab_cc(){return vectorSource=new ol.source.Vector({url:optic_cab_cc__stat.features[i].link,projection:"EPSG:3857",format:new ol.format.GeoJSON}),optic_cab_cc_id=new ol.layer.Vector({source:vectorSource,name:"cables_cc_"+optic_cab_cc__stat.features[i].wires}),optic_cab_cc_id}function coax_cab_cc(){return vectorSource=new ol.source.Vector({url:coax_cab_cc__stat.features[i].link,projection:"EPSG:3857",format:new ol.format.GeoJSON}),coax_cab_cc_id=new ol.layer.Vector({source:vectorSource,name:"cables_cc_"+coax_cab_cc__stat.features[i].wires}),coax_cab_cc_id}function multipair_cab_cc(){return vectorSource=new ol.source.Vector({url:multipair_cab_cc__stat.features[i].link,projection:"EPSG:3857",format:new ol.format.GeoJSON}),multipair_cab_cc_id=new ol.layer.Vector({source:vectorSource,name:"cables_cc_"+multipair_cab_cc__stat.features[i].wires}),multipair_cab_cc_id}function buildLayerTree(layer){var elem,name=layer.get("name")?layer.get("name"):"Group",div="<li data-layerid='"+name+"'><span><i class='glyphicon glyphicon-file'></i> "+layer.get("name")+"</span><i class='glyphicon glyphicon-check'></i> ";if(layer.getLayers){for(var sublayersElem="",layers=layer.getLayers().getArray(),len=layers.length,i=len-1;i>=0;i--)sublayersElem+=buildLayerTree(layers[i]);elem=div+" <ul>"+sublayersElem+"</ul></li>"}else elem=div+" </li>";return elem}function initializeTree(){var elem=buildLayerTree(map.getLayerGroup());$("#layertree").empty().append(elem),$(".tree li:has(ul)").addClass("parent_li").find(" > span").attr("title","Collapse this branch"),$(".tree li.parent_li > span").on("click",function(e){var children=$(this).parent("li.parent_li").find(" > ul > li");children.is(":visible")?(children.hide("fast"),$(this).attr("title","Expand this branch").find(" > i").addClass("glyphicon-plus").removeClass("glyphicon-minus")):(children.show("fast"),$(this).attr("title","Collapse this branch").find(" > i").addClass("glyphicon-minus").removeClass("glyphicon-plus")),e.stopPropagation()})}function findBy(layer,key,value){if(layer.get(key)===value)return layer;if(layer.getLayers)for(var result,layers=layer.getLayers().getArray(),len=layers.length,i=0;len>i;i++)if(result=findBy(layers[i],key,value))return result;return null}optic_cab_cc__list();for(var i=0;i<optic_cab_cc__stat.features.length;i++)optic_cab_cc__stat.features[i].link="http://77.121.192.25/test_cherkassy_cc_"+optic_cab_cc__stat.features[i].wires+".php";console.log("optic_cab_cc__list",optic_cab_cc__stat),coax_cab_cc__list();for(var i=0;i<coax_cab_cc__stat.features.length;i++)coax_cab_cc__stat.features[i].link="http://77.121.192.25/test_cherkassy_cc_"+coax_cab_cc__stat.features[i].wires+".php";console.log("coax_cab_cc__list",coax_cab_cc__stat),multipair_cab_cc__list();for(var i=0;i<multipair_cab_cc__stat.features.length;i++)multipair_cab_cc__stat.features[i].link="http://77.121.192.25/test_cherkassy_cc_"+multipair_cab_cc__stat.features[i].wires+".php";console.log("multipair_cab_cc__list",multipair_cab_cc__stat);var centerPoint=[{lon:32.081388,lat:49.432119,zoom:12}],osmLayer=new ol.layer.Tile({source:new ol.source.OSM({layer:"osm"}),name:"OSM"}),_buildings;cherkassy_buildings();for(var optic_cab_cc_group=[],i=0;i<optic_cab_cc__stat.features.length;i++)optic_cab_cc_group.push(optic_cab_cc(i,optic_cab_cc__stat));for(var optic_cab_cc_group_layer=new ol.layer.Group({layers:optic_cab_cc_group.reverse(),name:"optic cc group"}),coax_cab_cc_group=[],i=0;i<coax_cab_cc__stat.features.length;i++)coax_cab_cc_group.push(coax_cab_cc(i,coax_cab_cc__stat));for(var coax_cab_cc_group_layer=new ol.layer.Group({layers:coax_cab_cc_group,name:"coax cc group"}),multipair_cab_cc_group=[],i=0;i<multipair_cab_cc__stat.features.length;i++)multipair_cab_cc_group.push(multipair_cab_cc(i,multipair_cab_cc__stat));var multipair_cab_cc_group_layer=new ol.layer.Group({layers:multipair_cab_cc_group,name:"multipair cc group"}),map=new ol.Map({target:"map",renderer:"canvas",layers:[osmLayer,optic_cab_cc_group_layer,coax_cab_cc_group_layer,multipair_cab_cc_group_layer,_buildings],view:new ol.View({center:ol.proj.transform([centerPoint[0].lon,centerPoint[0].lat],"EPSG:4326","EPSG:3857"),zoom:centerPoint[0].zoom})});map.getLayerGroup().set("name","Root"),$(document).ready(function(){initializeTree(),$("i").on("click",function(){var layername=$(this).closest("li").data("layerid"),layer=findBy(map.getLayerGroup(),"name",layername);layer.setVisible(!layer.getVisible()),layer.getVisible()?$(this).removeClass("glyphicon-unchecked").addClass("glyphicon-check"):$(this).removeClass("glyphicon-check").addClass("glyphicon-unchecked")}),$("#optic_cc_statistic").addsttistic(optic_cab_cc__stat),$("#coax_cc_statistic").addsttistic(coax_cab_cc__stat),$("#multipair_cc_statistic").addsttistic(multipair_cab_cc__stat)}),function($){$.fn.addsttistic=function(params){this.append("<table></table>");var table=$(this).children();table.append("<thead><tr><td>cable_type</td><td>wires</td><td>quantity</td></tr></thead>");for(var i=0;i<params.features.length;i++)table.append("<tr><td>"+params.features[i].cable_type+"</td><td>"+params.features[i].wires+"</td><td>"+params.features[i].count+"</td></tr>")}}(jQuery);